#
# Minimal Sphinx configuration sample (clean, simple, functional)
#

source src1
{
    type            = mysql
    sql_host        = mysql_host
    sql_user        = mysql_user
    sql_pass        = mysql_password
    sql_db          = mysql_database
    sql_port        = 3306  # optional, default is 3306

    sql_query_pre   = SET @a := 1;
    sql_query       = \
        SELECT \
          @a := @a + 1 AS id, \
          Events.EventId eventid, \
          Events.EventDate eventdate, \
          Events.Season season, \
          Events.Hathi hathi, \
          Events.commentC commentc, \
          Events.CommentCClean commentcclean, \
          Events.theatreId theatreid, \
          Performances.PerformanceId performanceid, \
          Performances.PerformanceOrder performanceorder, \
          Performances.PType ptype, \
          Performances.PerformanceTitle performancetitle, \
          Performances.PerfTitleClean perftitleclean, \
          Performances.CommentP commentp, \
          Performances.CommentPClean commentpclean, \
          Performances.CastAsListed castaslisted, \
          Performances.DetailedComment detailedcomment, \
          Cast.CastId castid, \
          Cast.Role role, \
          Cast.RoleClean roleclean, \
          Cast.PerformerClean performerclean, \
          Cast.Performer performer, \
          Theatre.Volume volume, \
          Theatre.TheatreName theatrename, \
          Works.WorkId workid, \
          Author.AuthId authid, \
          Author.AuthName authname, \
          Author.AuthNameClean authnameclean \
        FROM Events \
          LEFT JOIN Performances ON Performances.EventId = Events.EventId \
          LEFT JOIN Cast ON Cast.PerformanceId = Performances.PerformanceId \
          LEFT JOIN Theatre ON Theatre.TheatreId = Events.TheatreId \
          LEFT JOIN Works ON Works.WorkId = Performances.WorkId \
          LEFT JOIN WorkAuthMaster on WorkAuthMaster.WorkId = Works.WorkId \
          LEFT JOIN Author on Author.AuthId = WorkAuthMaster.AuthId

    sql_field_string = commentcclean
    sql_field_string = perftitleclean
    sql_field_string = commentpclean
    sql_field_string = roleclean
    sql_field_string = performerclean
    sql_field_string = authnameclean
    sql_attr_uint    = eventid
    sql_attr_uint    = eventdate
    sql_attr_string  = season
    sql_attr_string  = hathi
    sql_attr_string  = commentc
    sql_attr_uint    = theatreid
    sql_attr_uint    = performanceid
    sql_attr_uint    = performanceorder
    sql_attr_string  = ptype
    sql_attr_string  = performancetitle
    sql_attr_string  = commentp
    sql_attr_string  = castaslisted
    sql_attr_string  = detailedcomment
    sql_attr_uint    = castid
    sql_attr_string  = role
    sql_attr_string  = performer
    sql_attr_uint    = volume
    sql_attr_string  = theatrename
    sql_attr_uint    = workid
    sql_attr_uint    = authid
    sql_attr_string  = authname
}


index london_stages
{
    source          = src1
    path            = /opt/sphinx/index/london_stages  # or where you prefer it be stored
    expand_keywords = 1
    min_infix_len   = 3
}


index real_time_index
{
    type            = rt
    rt_mem_limit    = 256M

    path            = /opt/sphinx/index/real_time_index  # or where you prefer it be stored

    rt_field = commentcclean
    rt_field = perftitleclean
    rt_field = commentpclean
    rt_field = roleclean
    rt_field = performerclean
    rt_field = authnameclean
    rt_attr_uint    = eventdate
    rt_attr_string  = season
    rt_attr_string  = hathi
    rt_attr_string  = commentc
    rt_attr_uint    = theatreid
    rt_attr_uint    = performanceid
    rt_attr_uint    = performanceorder
    rt_attr_string  = ptype
    rt_attr_string  = performancetitle
    rt_attr_string  = commentp
    rt_attr_string  = castaslisted
    rt_attr_string  = detailedcomment
    rt_attr_uint    = castid
    rt_attr_string  = role
    rt_attr_string  = performer
    rt_attr_uint    = volume
    rt_attr_string  = theatrename
    rt_attr_uint    = workid
    rt_attr_uint    = authid
    rt_attr_string  = authname
}


indexer
{
    mem_limit       = 512M
}


searchd
{
    listen          = 9312
    listen          = 9306:mysql41
    log             = /opt/sphinx/log/searchd.log  # update if needed
    query_log       = /opt/sphinx/log/query.log    # update if needed
    read_timeout    = 5
    max_children    = 30
    pid_file        = /opt/sphinx/data/searchd.pid # update if needed
    seamless_rotate = 1
    preopen_indexes = 1
    unlink_old      = 1
    workers         = threads # for RT to work
    binlog_path     = /opt/sphinx/data   # or where you prefer it be stored
}
